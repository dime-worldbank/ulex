<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="What the package does (one paragraph).">
<title>Unique Location Extrator • ulex</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Unique Location Extrator">
<meta property="og:description" content="What the package does (one paragraph).">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">ulex</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="unique-location-extractor-ulex-">Unique Location Extractor (ULEx) <a class="anchor" aria-label="anchor" href="#unique-location-extractor-ulex-"></a>
</h1>
</div>
<!-- badges: start -->

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Text often contains references to the locations of events where we want to extract the location of the event. For example, consider this example tweet that reports a road traffic crash in Nairobi, Kenya, where we are interested in determining the location of the crash:</p>
<blockquote>
<p>crash occurred near garden city on thika road on your way towards roysambu.</p>
</blockquote>
<p>The tweet contains three location references: (1) garden city, (2) thika road and (3) roysambu, where ‘garden city’ is the name of multiple locations that are over 20 kilometers apart. Here, we are interested in extracting the location of the garden city location on thika road that represents the crash site.</p>
<p>The Unique Location Extractor (ULEx) geoparses text to extract the unique location of events. The algorithm takes advantage of contextual information contained within text (references to roads or administrate areas, such as neighborhoods) and determines which location references do not reference the event of interest and should be ignored.</p>
<p>This package was originally developed to extract locations of road traffic crashes from reports of crashes via Twitter, specifically in the context of Nairobi, Kenya using the Twitter feed <a href="https://twitter.com/Ma3Route?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor" class="external-link">@Ma3Route</a>.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of <code>ulex</code> from GitHub with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"worldbank/rsocialwatcher"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="main-functions">Main functions<a class="anchor" aria-label="anchor" href="#main-functions"></a>
</h2>
<p>The package contains two main functions:</p>
<ul>
<li><p><strong>augment_gazetteer:</strong> The backbone of locating events is looking up location references in a gazetteer, or geographic dictionary. The <code>augment_gazetteer</code> facilitates cleaning a gazetteer that may have been constructed from sources such as <a href="https://cran.r-project.org/web/packages/osmdata/vignettes/osmdata.html" class="external-link">OpenStreetMaps</a>, <a href="https://github.com/ropensci/geonames" class="external-link">Geonames</a> or <a href="https://www.rdocumentation.org/packages/googleway/versions/2.7.1/topics/google_places" class="external-link">Google Maps</a>.</p></li>
<li><p><strong>locate_event:</strong> Takes text as input and returns the location of the relevant event. Key inputs include the text to geoparse, a gazetteer of landmarks, spatial files of roads and areas (e.g., neighborhoods) and a list of event words.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<ul>
<li><a href="#setup">Setup</a></li>
<li><a href="#create-loc-data">Create location datasets</a></li>
<li><a href="#create-areas">Dataset of Wards</a></li>
<li><a href="#create-roads">Dataset of roads</a></li>
<li><a href="#create-landmarks">Dataset of landmarks (landmark gazetteer)</a></li>
</ul>
<div class="section level3">
<h3 id="setup-">Setup <a name="setup"></a>
<a class="anchor" aria-label="anchor" href="#setup-"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#### Install package</span></span>
<span><span class="co">## Install/Load Package Dependencies</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://github.com/trinker/pacman" class="external-link">"pacman"</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"pacman"</span><span class="op">)</span></span>
<span><span class="fu">pacman</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pacman/man/p_load.html" class="external-link">p_load</a></span><span class="op">(</span><span class="va">magrittr</span>, <span class="va">lubridate</span>, <span class="va">dplyr</span>, <span class="va">tidyr</span>, <span class="va">readr</span>, <span class="va">purrr</span>, <span class="va">tidytext</span>,</span>
<span>               <span class="va">stringr</span>, <span class="va">stringi</span>, <span class="va">ngram</span>, <span class="va">hunspell</span>, <span class="va">stringdist</span>, <span class="va">tm</span>, <span class="va">raster</span>,</span>
<span>               <span class="va">parallel</span>, <span class="va">jsonlite</span>, <span class="va">sf</span>, <span class="va">quanteda</span>, <span class="va">geodist</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://spacyr.quanteda.io" class="external-link">spacyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Load ULEx Functions</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"~/Documents/Github/ulex/R/helper_functions.R"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"~/Documents/Github/ulex/R/augment_gazetteer.R"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"~/Documents/Github/ulex/R/locate_event.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">geodata</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/osmdata/" class="external-link">osmdata</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-location-datasets-">Create location datasets <a name="create-loc-data"></a>
<a class="anchor" aria-label="anchor" href="#create-location-datasets-"></a>
</h3>
<div class="section level4">
<h4 id="dataset-of-wards-">Dataset of Wards <a name="create-areas"></a>
<a class="anchor" aria-label="anchor" href="#dataset-of-wards-"></a>
</h4>
<p>We create a dataset of Wards in Nairobi from <a href="https://gadm.org/data.html" class="external-link">GADM</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ken_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geodata/man/gadm.html" class="external-link">gadm</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"KEN"</span>, level <span class="op">=</span> <span class="fl">3</span>, path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">nbo_sf</span> <span class="op">&lt;-</span> <span class="va">ken_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">NAME_1</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="st">"Nairobi"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">rename</span><span class="op">(</span>name <span class="op">=</span> <span class="va">NAME_3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nbo_sf</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 36.67803 ymin: -1.302667 xmax: 36.81967 ymax: -1.256238</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;         name                       geometry</span></span>
<span><span class="co">#&gt; 1     Gatina POLYGON ((36.7601 -1.268443...</span></span>
<span><span class="co">#&gt; 2 Kileleshwa POLYGON ((36.81139 -1.27213...</span></span>
<span><span class="co">#&gt; 3   Kilimani POLYGON ((36.75393 -1.28606...</span></span>
<span><span class="co">#&gt; 4     Kabiro POLYGON ((36.7373 -1.275437...</span></span>
<span><span class="co">#&gt; 5 Kawangware POLYGON ((36.74915 -1.27165...</span></span>
<span><span class="co">#&gt; 6   Mutu-Ini POLYGON ((36.67803 -1.29837...</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="dataset-of-roads-">Dataset of roads <a name="create-roads"></a>
<a class="anchor" aria-label="anchor" href="#dataset-of-roads-"></a>
</h4>
<p>We create a dataset of roads from <a href="https://www.openstreetmap.org/" class="external-link">OpenStreetMaps</a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">roads_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/opq.html" class="external-link">opq</a></span><span class="op">(</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">nbo_sf</span><span class="op">)</span>, timeout <span class="op">=</span> <span class="fl">999</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/add_osm_feature.html" class="external-link">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"highway"</span>, value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"motorway"</span>,</span>
<span>                                             <span class="st">"trunk"</span>,</span>
<span>                                             <span class="st">"primary"</span>,</span>
<span>                                             <span class="st">"secondary"</span>,</span>
<span>                                             <span class="st">"tertiary"</span>,</span>
<span>                                             <span class="st">"unclassified"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/osmdata_sf.html" class="external-link">osmdata_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">roads_sf</span> <span class="op">&lt;-</span> <span class="va">roads_sf</span><span class="op">$</span><span class="va">osm_lines</span></span>
<span></span>
<span><span class="va">roads_sf</span> <span class="op">&lt;-</span> <span class="va">roads_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="va">name</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">roads_sf</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 36.80283 ymin: -1.348233 xmax: 36.91442 ymax: -1.286476</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;                              name                       geometry</span></span>
<span><span class="co">#&gt; 4685092        airport south road LINESTRING (36.91442 -1.344...</span></span>
<span><span class="co">#&gt; 4716860        state house avenue LINESTRING (36.80434 -1.286...</span></span>
<span><span class="co">#&gt; 4716861          processional way LINESTRING (36.81367 -1.287...</span></span>
<span><span class="co">#&gt; 4716862           kenyatta avenue LINESTRING (36.81026 -1.289...</span></span>
<span><span class="co">#&gt; 4716887           kenyatta avenue LINESTRING (36.81188 -1.289...</span></span>
<span><span class="co">#&gt; 4723375 city mortuary round about LINESTRING (36.80306 -1.298...</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="dataset-of-landmarks-landmark-gazetteer-">Dataset of landmarks (landmark gazetteer) <a name="create-landmarks"></a>
<a class="anchor" aria-label="anchor" href="#dataset-of-landmarks-landmark-gazetteer-"></a>
</h4>
<p>We create a gazetteer of landmarks from <a href="https://www.openstreetmap.org/" class="external-link">OpenStreetMaps</a>. From OpenStreetMaps, we use all amenities and bus stops.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Amenities --------------------------------------------------------------------</span></span>
<span><span class="va">amenities_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/opq.html" class="external-link">opq</a></span><span class="op">(</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">nbo_sf</span><span class="op">)</span>, timeout <span class="op">=</span> <span class="fl">999</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/add_osm_feature.html" class="external-link">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"amenity"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/osmdata_sf.html" class="external-link">osmdata_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">amenities_pnt_sf</span> <span class="op">&lt;-</span> <span class="va">amenities_sf</span><span class="op">$</span><span class="va">osm_points</span></span>
<span><span class="va">amenities_ply_sf</span> <span class="op">&lt;-</span> <span class="va">amenities_sf</span><span class="op">$</span><span class="va">osm_polygons</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">st_centroid</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">amenities_sf</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">amenities_pnt_sf</span>,</span>
<span>                          <span class="va">amenities_ply_sf</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="va">amenity</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bus Stops --------------------------------------------------------------------</span></span>
<span><span class="va">busstops_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/opq.html" class="external-link">opq</a></span><span class="op">(</span><span class="fu">st_bbox</span><span class="op">(</span><span class="va">nbo_sf</span><span class="op">)</span>, timeout <span class="op">=</span> <span class="fl">999</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/add_osm_feature.html" class="external-link">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"highway"</span>,</span>
<span>                  value <span class="op">=</span> <span class="st">"bus_stop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/osmdata_sf.html" class="external-link">osmdata_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">busstops_sf</span> <span class="op">&lt;-</span> <span class="va">busstops_sf</span><span class="op">$</span><span class="va">osm_points</span></span>
<span></span>
<span><span class="va">busstops_sf</span> <span class="op">&lt;-</span> <span class="va">busstops_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"bus_stop"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Append -----------------------------------------------------------------------</span></span>
<span><span class="va">landmarks_sf</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">amenities_sf</span>,</span>
<span>                          <span class="va">busstops_sf</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>name <span class="op">=</span> <span class="va">name</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">landmarks_sf</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 36.70606 ymin: -1.325597 xmax: 36.80624 ymax: -1.292358</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;                                        name             type</span></span>
<span><span class="co">#&gt; 30031187 regina caeli karen catholic church place_of_worship</span></span>
<span><span class="co">#&gt; 30088423                        china plate       restaurant</span></span>
<span><span class="co">#&gt; 30088443                              rubis             fuel</span></span>
<span><span class="co">#&gt; 30088444                      shell kabuagi             fuel</span></span>
<span><span class="co">#&gt; 30088453               karen police station           police</span></span>
<span><span class="co">#&gt; 30092033                              total             fuel</span></span>
<span><span class="co">#&gt;                            geometry</span></span>
<span><span class="co">#&gt; 30031187  POINT (36.7107 -1.325597)</span></span>
<span><span class="co">#&gt; 30088423 POINT (36.80624 -1.292358)</span></span>
<span><span class="co">#&gt; 30088443 POINT (36.71747 -1.317521)</span></span>
<span><span class="co">#&gt; 30088444 POINT (36.71842 -1.316594)</span></span>
<span><span class="co">#&gt; 30088453 POINT (36.70606 -1.321773)</span></span>
<span><span class="co">#&gt; 30092033 POINT (36.78867 -1.299975)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="map-locations">Map locations<a class="anchor" aria-label="anchor" href="#map-locations"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">roads_sf</span>,</span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Roads"</span><span class="op">)</span>,</span>
<span>          linewidth <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">landmarks_sf</span>,</span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Landmarks"</span><span class="op">)</span>,</span>
<span>          size <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>          alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nbo_sf</span>,</span>
<span>          fill <span class="op">=</span> <span class="st">"gray"</span>,</span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Wards"</span><span class="op">)</span>,</span>
<span>          linewidth <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>          alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Landmarks, Roads, and Wards"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"chartreuse3"</span>, <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png" width="100%"></p>
</div>
</div>
<div class="section level3">
<h3 id="augment-gazetteer-">Augment Gazetteer <a name="aug-gazetteer"></a>
<a class="anchor" aria-label="anchor" href="#augment-gazetteer-"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landmarks_aug_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/augment_gazetteer.html">augment_gazetteer</a></span><span class="op">(</span><span class="va">landmarks_sf</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="locate-events-">Locate Events <a name="loc-events"></a>
<a class="anchor" aria-label="anchor" href="#locate-events-"></a>
</h3>
<p>We geolocate 5 tweets.</p>
<ol style="list-style-type: decimal">
<li><strong>crash at garden city</strong></li>
</ol>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tweets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"crash at garden city"</span>,</span>
<span>            <span class="st">"crash occurred near garden city on thika road on your way towards </span></span>
<span><span class="st">            roysambu"</span>,</span>
<span>            <span class="st">"crash at intersection of juja road and outer ring rd"</span>,</span>
<span>            <span class="st">"crash occured near roysambu on thika rd"</span>,</span>
<span>            <span class="st">"crash near mathare centre along juja road"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">crashes_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/locate_event.html">locate_event</a></span><span class="op">(</span>text <span class="op">=</span> <span class="va">tweets</span>,</span>
<span>                           landmark_gazetteer <span class="op">=</span> <span class="va">landmarks_aug_sf</span>,</span>
<span>                           areas <span class="op">=</span> <span class="va">nbo_sf</span>,</span>
<span>                           roads <span class="op">=</span> <span class="va">roads_sf</span>,</span>
<span>                           event_words <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"accident"</span>, <span class="st">"crash"</span>, <span class="st">"collision"</span>, </span>
<span>                                           <span class="st">"wreck"</span>, <span class="st">"overturn"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">nbo_sf</span>,</span>
<span>          fill <span class="op">=</span> <span class="st">"gray"</span>,</span>
<span>          color <span class="op">=</span><span class="st">"gray"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">crashes_sf</span>,</span>
<span>          pch <span class="op">=</span> <span class="fl">21</span>,</span>
<span>          color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>          fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-9-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="additional-information-for-main-functions">Additional information for main functions<a class="anchor" aria-label="anchor" href="#additional-information-for-main-functions"></a>
</h2>
<div class="section level3">
<h3 id="augment_gazetteer">augment_gazetteer<a class="anchor" aria-label="anchor" href="#augment_gazetteer"></a>
</h3>
<p>The <code>augment_gazetteer</code> function adds additional landmarks to account for different ways of saying the same landmark name. For example, raw gazetteers may contain long, formal names, where shorter versions of the name are more often used. In addition, the function facilitates removing landmarks names that are spurious or may confuse the algorithm; these include landmark names that are common words that may be used in different contexts, or frequent and generic landmarks such as <code>hotel</code>. Key components of the function include:</p>
<ol style="list-style-type: decimal">
<li>Adding additional landmarks based off of n-grams and skip-grams of landmark names. For example, from the original landmark <code>garden city mall</code>, the following landmarks will be added: <code>garden city</code>, <code>city mall</code>, and <code>garden mall</code>.</li>
<li>Adding landmarks according to a set of rules: for example, if a landmark starts or ends with a certain word, an alternative version of the landmark is added that removes that word. Here, words along categories of landmarks are removed, where a user may not reference the category; for example, a user will more likely say <code>McDonalds</code> than <code>McDonalds restaurant.</code>
</li>
<li>Removes landmarks that refer to large geographic areas (e.g., roads). Roads and areas are dealt with separately; this function focuses on cleaning a gazetteer of specific points/landmarks.</li>
</ol>
</div>
<div class="section level3">
<h3 id="locate_event">locate_event<a class="anchor" aria-label="anchor" href="#locate_event"></a>
</h3>
<p>The <code>locate_event</code> function extracts landmarks from text and determines the unique location of events from the text. The algorithm works in two steps: (1) finding locations in text and (2) determining a unique location.</p>
<p><em>Finding location references in text</em></p>
<p>To extract location references from text, the function implements the following steps to extract location references from text.</p>
<ol style="list-style-type: decimal">
<li>Determines whether any text matches names in the gazetteer. Both exact and ‘fuzzy’ matches (allowing a certain Levenstein distance) are used.</li>
<li>Rely on words after prepositions to find locations. The algorithm starts with a word after a preposition and extracts all landmarks that contain that word. Then, the algorithm takes the next word in the text and further subsets the landmarks. This process is repeated until adding a word removes all landmarks. If a road or area (eg, neighborhood) is found in the previous step, only landmarks near that road or neighborhood are considered. Landmarks with the shortest number of words are kept (i.e., if this process finds 5 landmarks with 2 words and 7 landmarks with 3 words, only the 5 landmarks with 2 words are kept).</li>
<li>If a road or area is mentioned and a landmark is not near that road or landmark, longer versions of the landmark that are near the road or area are searched for. For example, if a user says <code>crash near garden on thika road</code>, the algorithm may extract multiple landmarks with the name <code>garden</code>, none of which are near Thika road. It will then search for all landmarks that contain <code>garden</code> in them (e.g., <code>garden city mall</code>) that are near Thika road.</li>
<li>If two roads are mentioned, the algorithm extracts the intersection of the roads.</li>
</ol>
<p><em>Determine unique location</em></p>
<p>After extracting landmarks, the algorithm seeks to identify a single location using a series of steps. These steps consider a defined list of event words (eg, for road traffic crashes, these could include ‘crash’, ‘accident’, ‘overturn’, etc), whether the user mentions a junction word (e.g., ‘junction’ or ‘intersection’) and a list of prepositions. Certain prepositions are given precedent over others to distinguish between locations indicating the location of an event versus locations further away that provide additional context; for example, <code>at</code> takes higher precedence that <code>towards</code>. The following main series of steps are used in the following order:</p>
<ol style="list-style-type: decimal">
<li>Locations that follow the pattern [event word] [preposition] [location] are extracted.</li>
<li>Locations that follow the pattern [preposition] [location] are extracted. If multiple occurrences, the location near the higher order preposition is used. If a tie, the location closest to the event word is used.</li>
<li>If a junction word is used, two roads are mentioned, and the two roads intersect once, the intersection point is used.</li>
<li>The location closest to the event word within the text is used.</li>
<li>If the location name has multiple locations, we (1) restrict to locations near any mentioned road or area, (2) check for a dominant cluster of locations and (3) prioritize certain landmark types over others (e.g., a user is more likely to reference a large, well known location type like a stadium).</li>
<li>If a landmark is not found, but a road or area are found, the road or area are returned. If a road and area are mentioned, the intersection of the road and area is returned.</li>
</ol>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ulex</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Robert Marty <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-3164-3813" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=ulex" class="external-link"><img src="http://www.r-pkg.org/badges/version/ulex" alt="CRAN_Status_Badge"></a></li>
<li><a href="https://github.com/worldbank/ulex/graphs/commit-activity" class="external-link"><img src="https://img.shields.io/github/commit-activity/m/worldbank/ulex" alt="activity"></a></li>
<li><a href="https://opensource.org/license/mit" class="external-link"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Robert Marty.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
